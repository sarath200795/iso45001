<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISO 45001 | Enterprise Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .glass-panel { background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); }
    </style>
</head>
<body class="bg-slate-900 h-screen flex items-center justify-center overflow-hidden relative">

    <div class="absolute inset-0 z-0">
        <div class="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-blue-600/20 rounded-full blur-[120px]"></div>
        <div class="absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-emerald-600/10 rounded-full blur-[120px]"></div>
    </div>

    <div id="root" class="z-10 w-full max-w-md p-6"></div>

    <script type="text/babel">
        const { useState } = React;

        const Login = () => {
            const [formData, setFormData] = useState({ orgId: '', email: '', password: '' });
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            const handleLogin = (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');

                setTimeout(() => {
                    const cleanOrgId = formData.orgId.toUpperCase().replace(/[^A-Z0-9-]/g, '');
                    const dbKey = `ISO_DB_${cleanOrgId}`;
                    
                    // 1. Check if Org Exists
                    const rawData = localStorage.getItem(dbKey);
                    
                    if (!rawData) {
                        setError("Organization ID not found. Please register first.");
                        setLoading(false);
                        return;
                    }

                    // 2. Parse DB and Find User
                    const db = JSON.parse(rawData);
                    const user = db.users.find(u => u.email.toLowerCase() === formData.email.toLowerCase() && u.password === formData.password);

                    if (!user) {
                        setError("Invalid Email or Password.");
                        setLoading(false);
                        return;
                    }

                    // 3. Create Session with Role
                    const session = {
                        orgId: cleanOrgId,
                        orgName: db.meta.name,
                        user: user.name,
                        email: user.email,
                        role: user.role, // WILL BE "Owner"
                        token: Date.now().toString(36)
                    };

                    sessionStorage.setItem('isoSession', JSON.stringify(session));
                    window.location.href = "home.html";

                }, 1000);
            };

            return (
                <div className="glass-panel rounded-3xl p-10 shadow-2xl text-white relative">
                    <div className="text-center mb-10">
                        <div className="w-16 h-16 bg-blue-600 rounded-2xl mx-auto flex items-center justify-center mb-4 shadow-lg shadow-blue-500/30">
                            <i className="fas fa-shield-halved text-3xl"></i>
                        </div>
                        <h1 className="text-2xl font-black italic uppercase tracking-tighter">ISO 45001 Master</h1>
                        <p className="text-blue-300 text-[10px] font-bold uppercase tracking-[0.2em]">Secure Access Portal</p>
                    </div>

                    <form onSubmit={handleLogin} className="space-y-4">
                        {error && <div className="bg-red-500/20 border border-red-500/50 p-3 rounded-xl text-xs text-red-200 text-center font-bold mb-4">{error}</div>}
                        
                        <div className="space-y-1">
                            <label className="text-[9px] font-bold uppercase text-slate-400 ml-2">Organization ID</label>
                            <input required className="w-full bg-slate-950/50 border border-slate-700 focus:border-blue-500 rounded-xl py-3 px-4 outline-none transition text-sm font-bold uppercase tracking-wider"
                                placeholder="ORG-ID" value={formData.orgId} onChange={e => setFormData({...formData, orgId: e.target.value})} />
                        </div>

                        <div className="space-y-1">
                            <label className="text-[9px] font-bold uppercase text-slate-400 ml-2">Email</label>
                            <input type="email" required className="w-full bg-slate-950/50 border border-slate-700 focus:border-blue-500 rounded-xl py-3 px-4 outline-none transition text-sm"
                                placeholder="user@org.com" value={formData.email} onChange={e => setFormData({...formData, email: e.target.value})} />
                        </div>

                        <div className="space-y-1">
                            <label className="text-[9px] font-bold uppercase text-slate-400 ml-2">Password</label>
                            <input type="password" required className="w-full bg-slate-950/50 border border-slate-700 focus:border-blue-500 rounded-xl py-3 px-4 outline-none transition text-sm"
                                placeholder="••••••••" value={formData.password} onChange={e => setFormData({...formData, password: e.target.value})} />
                        </div>

                        <button disabled={loading} className="w-full bg-blue-600 hover:bg-blue-500 text-white py-4 rounded-xl font-black uppercase text-xs tracking-widest shadow-lg mt-2 transition-all">
                            {loading ? <i className="fas fa-spinner fa-spin"></i> : 'Secure Login'}
                        </button>
                    </form>
                    
                    <div className="mt-8 text-center pt-6 border-t border-white/5">
                        <p className="text-[10px] text-slate-400 mb-2">New Organization?</p>
                        <a href="register.html" className="text-xs font-bold text-blue-400 hover:text-white uppercase tracking-wide transition">Initialize New System <i className="fas fa-arrow-right ml-1"></i></a>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Login />);
    </script>
</body>
</html>