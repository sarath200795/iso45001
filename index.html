<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISO 45001 | Enterprise Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'display': ['Space Grotesk', 'sans-serif'],
                        'mono': ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        'iso': {
                            'primary': '#0f172a',
                            'accent': '#3b82f6',
                            'success': '#10b981',
                            'warning': '#f59e0b',
                            'danger': '#ef4444',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Space Grotesk', sans-serif; }
        .glass-panel { 
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(30, 41, 59, 0.8) 100%);
            backdrop-filter: blur(20px); 
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        .glow-effect {
            box-shadow: 0 0 60px rgba(59, 130, 246, 0.3), 0 0 120px rgba(59, 130, 246, 0.1);
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
        .animate-float { animation: float 6s ease-in-out infinite; }
        .animate-float-delayed { animation: float 6s ease-in-out infinite 2s; }
        .input-field {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .input-field:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
    </style>
</head>
<body class="bg-slate-950 min-h-screen flex items-center justify-center overflow-hidden relative">

    <!-- Animated Background -->
    <div class="absolute inset-0 z-0 overflow-hidden">
        <div class="absolute top-[-20%] left-[-10%] w-[600px] h-[600px] bg-blue-600/20 rounded-full blur-[150px] animate-float"></div>
        <div class="absolute bottom-[-20%] right-[-10%] w-[500px] h-[500px] bg-emerald-600/15 rounded-full blur-[120px] animate-float-delayed"></div>
        <div class="absolute top-[40%] right-[20%] w-[300px] h-[300px] bg-violet-600/10 rounded-full blur-[100px] animate-float"></div>
        
        <!-- Grid Pattern -->
        <div class="absolute inset-0" style="background-image: radial-gradient(circle at 1px 1px, rgba(59, 130, 246, 0.05) 1px, transparent 0); background-size: 40px 40px;"></div>
    </div>

    <div id="root" class="z-10 w-full max-w-md px-6"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const Login = () => {
            const [formData, setFormData] = useState({ orgId: '', email: '', password: '' });
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [focusedField, setFocusedField] = useState(null);

            useEffect(() => {
                // Check if already logged in
                const session = sessionStorage.getItem('isoSession');
                if (session) {
                    window.location.href = "home.html";
                }
            }, []);

            const handleLogin = (e) => {
                e.preventDefault();
                setLoading(true);
                setError('');

                setTimeout(() => {
                    const cleanOrgId = formData.orgId.toUpperCase().replace(/[^A-Z0-9-]/g, '');
                    const dbKey = `ISO_DB_${cleanOrgId}`;
                    
                    const rawData = localStorage.getItem(dbKey);
                    
                    if (!rawData) {
                        setError("Organization not found. Please register first.");
                        setLoading(false);
                        return;
                    }

                    const db = JSON.parse(rawData);
                    const user = db.users.find(u => 
                        u.email.toLowerCase() === formData.email.toLowerCase() && 
                        u.password === formData.password
                    );

                    if (!user) {
                        setError("Invalid credentials.");
                        setLoading(false);
                        return;
                    }

                    const session = {
                        orgId: cleanOrgId,
                        orgName: db.meta.name,
                        user: user.name,
                        email: user.email,
                        role: user.role,
                        assignedSite: user.assignedSite || '',
                        token: Date.now().toString(36)
                    };

                    sessionStorage.setItem('isoSession', JSON.stringify(session));
                    
                    // Store context for other pages
                    localStorage.setItem('orgId', cleanOrgId);
                    localStorage.setItem('companyName', db.meta.name);
                    
                    window.location.href = "home.html";
                }, 800);
            };

            const InputField = ({ type = "text", id, label, icon, placeholder, value, onChange, uppercase = false }) => (
                <div className="space-y-2">
                    <label className="text-[10px] font-bold uppercase tracking-[0.2em] text-slate-400 ml-1 flex items-center gap-2">
                        <i className={`fas ${icon} text-blue-400`}></i> {label}
                    </label>
                    <input 
                        type={type}
                        required
                        className={`input-field w-full bg-slate-900/50 border-2 ${focusedField === id ? 'border-blue-500' : 'border-slate-700/50'} rounded-xl py-4 px-5 outline-none text-white font-medium ${uppercase ? 'uppercase tracking-wider font-mono' : ''} placeholder:text-slate-500`}
                        placeholder={placeholder}
                        value={value}
                        onChange={e => onChange(uppercase ? e.target.value.toUpperCase() : e.target.value)}
                        onFocus={() => setFocusedField(id)}
                        onBlur={() => setFocusedField(null)}
                    />
                </div>
            );

            return (
                <div className="glass-panel rounded-3xl p-10 shadow-2xl glow-effect relative overflow-hidden">
                    {/* Decorative Elements */}
                    <div className="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-blue-500/10 to-transparent rounded-bl-[100px]"></div>
                    <div className="absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-emerald-500/10 to-transparent rounded-tr-[80px]"></div>
                    
                    {/* Header */}
                    <div className="text-center mb-10 relative">
                        <div className="relative inline-block">
                            <div className="absolute inset-0 bg-blue-500/30 rounded-2xl blur-xl"></div>
                            <div className="relative w-20 h-20 bg-gradient-to-br from-blue-500 to-blue-700 rounded-2xl mx-auto flex items-center justify-center shadow-xl">
                                <i className="fas fa-shield-halved text-4xl text-white"></i>
                            </div>
                        </div>
                        <h1 className="text-3xl font-bold text-white mt-6 tracking-tight">ISO 45001</h1>
                        <p className="text-blue-400 text-xs font-mono uppercase tracking-[0.3em] mt-2">Management System</p>
                    </div>

                    <form onSubmit={handleLogin} className="space-y-5 relative">
                        {error && (
                            <div className="bg-red-500/20 border border-red-500/50 p-4 rounded-xl text-sm text-red-200 text-center font-medium flex items-center gap-3 justify-center">
                                <i className="fas fa-exclamation-circle"></i> {error}
                            </div>
                        )}
                        
                        <InputField 
                            id="org"
                            label="Organization ID"
                            icon="fa-building"
                            placeholder="ORG-001"
                            value={formData.orgId}
                            onChange={(v) => setFormData({...formData, orgId: v})}
                            uppercase={true}
                        />

                        <InputField 
                            id="email"
                            type="email"
                            label="Email Address"
                            icon="fa-envelope"
                            placeholder="admin@company.com"
                            value={formData.email}
                            onChange={(v) => setFormData({...formData, email: v})}
                        />

                        <InputField 
                            id="password"
                            type="password"
                            label="Password"
                            icon="fa-lock"
                            placeholder="••••••••"
                            value={formData.password}
                            onChange={(v) => setFormData({...formData, password: v})}
                        />

                        <button 
                            type="submit" 
                            disabled={loading}
                            className="w-full bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white py-4 rounded-xl font-bold uppercase tracking-widest shadow-lg shadow-blue-500/25 transition-all duration-300 mt-4 flex items-center justify-center gap-3"
                        >
                            {loading ? (
                                <i className="fas fa-circle-notch fa-spin text-lg"></i>
                            ) : (
                                <>
                                    <i className="fas fa-right-to-bracket"></i>
                                    <span>Secure Login</span>
                                </>
                            )}
                        </button>
                    </form>
                    
                    <div className="mt-10 text-center pt-6 border-t border-slate-700/50">
                        <p className="text-slate-500 text-xs mb-3">New Organization?</p>
                        <a href="register.html" className="inline-flex items-center gap-2 text-sm font-bold text-blue-400 hover:text-blue-300 transition-colors group">
                            Initialize System <i className="fas fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
                        </a>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Login />);
    </script>
</body>
</html>
